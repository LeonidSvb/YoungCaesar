# Logging Best Practices - VAPI Analytics

## Industry Standards –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Dry-Run Testing ‚úÖ

**–ß—Ç–æ —ç—Ç–æ:**
–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª—è—Ü–∏–∏ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î/API.

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ side effects
- –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```bash
# Dry-run —Ä–µ–∂–∏–º
npm run test:logging

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
DRY_RUN=true node scripts/test_logging_dryrun.js
node scripts/test_logging_dryrun.js --dry-run

# –†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º
npm run test:logging:real
node scripts/test_logging_dryrun.js
```

### 2. Log Level Validation

**Best Practice:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü–æ–¥—Å—á–µ—Ç –ª–æ–≥–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º
grep -c '"level":"INFO"' logs/2025-10-18.log
grep -c '"level":"ERROR"' logs/2025-10-18.log
grep -c '"level":"WARN"' logs/2025-10-18.log
grep -c '"level":"DEBUG"' logs/2025-10-18.log

# –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑
grep -o '"level":"[^"]*"' logs/2025-10-18.log | sort | uniq -c
```

### 3. Structured Logging

**JSON —Ñ–æ—Ä–º–∞—Ç:**
```json
{
  "timestamp": "2025-10-18T09:31:38.035Z",
  "module": "logging-test",
  "level": "INFO",
  "message": "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω",
  "totalSteps": 5,
  "completedSteps": 5,
  "dryRun": false
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –õ–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—Å—è (jq, grep, awk)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ú–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELK, Grafana, etc.

### 4. Error Isolation

**–û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—à–∏–±–æ–∫:**
```
logs/
‚îú‚îÄ‚îÄ 2025-10-18.log          # –í—Å–µ –ª–æ–≥–∏
‚îî‚îÄ‚îÄ errors/
    ‚îî‚îÄ‚îÄ 2025-10-18.log      # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ ERROR –ª–æ–≥–∏
cat logs/errors/2025-10-18.log | grep '"level":"ERROR"' | wc -l
cat logs/errors/2025-10-18.log | wc -l
# –ß–∏—Å–ª–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
```

### 5. Log Rotation

**Date-based rotation:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ –¥–∞—Ç–∞–º
- `2025-10-18.log`, `2025-10-19.log`, etc.
- –ù–µ –Ω—É–∂–Ω—ã –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (logrotate)

**Cleanup —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤:**
```bash
# –ù–∞–π—Ç–∏ –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
find logs/ -name "*.log" -mtime +30

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
find logs/ -name "*.log" -mtime +30 -delete

# –ò–ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å
find logs/ -name "*.log" -mtime +30 -exec gzip {} \;
```

### 6. Performance Monitoring

**–õ–æ–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```javascript
const startTime = Date.now();
// ... –æ–ø–µ—Ä–∞—Ü–∏–∏ ...
logger.info('–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', {
  duration_ms: Date.now() - startTime,
  recordsProcessed: 1000
});
```

**–ê–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
```bash
# –û–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã
grep '"duration_ms"' logs/2025-10-18.log | \
  jq 'select(.duration_ms > 1000)'
```

### 7. Context Information

**–í—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç:**
```javascript
// –ü–ª–æ—Ö–æ ‚ùå
logger.error('–û—à–∏–±–∫–∞');

// –•–æ—Ä–æ—à–æ ‚úÖ
logger.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Supabase', {
  operation: 'insert',
  table: 'vapi_calls_raw',
  recordId: 'abc123',
  error: error.message
});
```

## –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (2025-10-18)

```
–í—Å–µ–≥–æ –ª–æ–≥–æ–≤:     37 —Å—Ç—Ä–æ–∫
INFO –ª–æ–≥–æ–≤:      32 (86.5%)
ERROR –ª–æ–≥–æ–≤:     2  (5.4%)
WARN –ª–æ–≥–æ–≤:      3  (8.1%)
```

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç

### –ü–µ—Ä–µ–¥ production –∑–∞–ø—É—Å–∫–æ–º:

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:logging` (dry-run)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª–æ–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ `logs/`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—à–∏–±–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ `logs/errors/`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON —Ñ–æ—Ä–º–∞—Ç –≤—Å–µ—Ö –ª–æ–≥–æ–≤
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —É—Ä–æ–≤–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (INFO, WARN, ERROR)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å production —Ä–µ–∂–∏–º `npm run test:logging:real`

### –ü–æ—Å–ª–µ production –∑–∞–ø—É—Å–∫–∞:

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- [ ] –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ (>30 –¥–Ω–µ–π)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD

```yaml
# .github/workflows/test.yml
- name: Test logging system
  run: |
    npm run test:logging
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ª–æ–≥–∏ —Å–æ–∑–¥–∞–Ω—ã
    test -f logs/$(date +%Y-%m-%d).log
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ dry-run
    ! grep -q '"level":"ERROR"' logs/$(date +%Y-%m-%d).log || exit 1
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏
tail -f logs/$(date +%Y-%m-%d).log

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
tail -f logs/errors/$(date +%Y-%m-%d).log

# –° —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (—Ç–æ–ª—å–∫–æ module: vapi-sync)
tail -f logs/$(date +%Y-%m-%d).log | grep '"module":"vapi-sync"'

# –° jq –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞
tail -f logs/$(date +%Y-%m-%d).log | jq -r '"\(.timestamp) [\(.level)] \(.message)"'
```

## Debug Mode

```bash
# –í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏ (–≤—Å–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏)
DEBUG=true node production_scripts/vapi_collection/src/sync_to_supabase.js

# –ë–µ–∑ debug (—Ç–æ–ª—å–∫–æ ERROR –≤ –∫–æ–Ω—Å–æ–ª–∏)
node production_scripts/vapi_collection/src/sync_to_supabase.js
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–æ–¥—Ö–æ–¥ | Vapi (CLI scripts) | Shadi (Next.js) | –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å |
|--------|-------------------|-----------------|-------------|
| **–ö–æ–≥–¥–∞ –ª–æ–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è** | –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ HTTP –∑–∞–ø—Ä–æ—Å–∞—Ö | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã |
| **–§–æ—Ä–º–∞—Ç** | JSON | JSON | JSON –¥–ª—è –æ–±–æ–∏—Ö ‚úÖ |
| **–†–æ—Ç–∞—Ü–∏—è** | –ü–æ –¥–∞—Ç–∞–º | –ü–æ –¥–∞—Ç–∞–º | –ü–æ –¥–∞—Ç–∞–º ‚úÖ |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | Dry-run —Ä–µ–∂–∏–º | Request mocking | Dry-run –¥–ª—è CLI ‚úÖ |

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–æ–¥—É–ª—è–º
jq -r '.module' logs/2025-10-18.log | sort | uniq -c

# –¢–æ–ø-10 —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
jq -r '.message' logs/2025-10-18.log | sort | uniq -c | sort -rn | head -10

# –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
jq -r 'select(.duration_ms != null) | .duration_ms' logs/2025-10-18.log | \
  awk '{sum+=$1; count++} END {print "Avg:", sum/count, "ms"}'

# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
jq -r '[.timestamp, .level, .module, .message] | @csv' logs/2025-10-18.log > logs.csv
```

## Best Practice Checklist

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ:**
- [x] JSON —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
- [x] –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º
- [x] –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—à–∏–±–æ–∫
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [x] Dry-run —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- [x] –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (INFO, WARN, ERROR, DEBUG)

üìù **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å log aggregation (ELK stack)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å alerts –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus/Grafana
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCI Analysis Dashboard - Young Caesar</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .language-toggle button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .language-toggle button:hover {
            background: #2980b9;
        }

        .language-toggle button.active {
            background: #e74c3c;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.95);
            margin-bottom: 30px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .assistant-section {
            background: rgba(255, 255, 255, 0.95);
            margin-bottom: 30px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .assistant-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }

        .assistant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .assistant-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .assistant-names {
            font-size: 0.8em;
            font-weight: normal;
            color: #7f8c8d;
            margin-top: 4px;
        }

        .assistant-score {
            font-size: 1.8em;
            font-weight: bold;
            color: #27ae60;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .score-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .score-item .score-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
        }

        .score-item .score-label {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .recommendations {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
        }

        .recommendations h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .recommendations ul {
            list-style-type: none;
            padding-left: 0;
        }

        .recommendations li {
            padding: 5px 0;
            color: #856404;
        }

        .recommendations li:before {
            content: "üí° ";
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }

        .quality-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .quality-pass {
            background: #d4edda;
            color: #155724;
        }

        .quality-review {
            background: #fff3cd;
            color: #856404;
        }

        .quality-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .insights-section {
            background: rgba(255, 255, 255, 0.95);
            margin-bottom: 30px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .insight-card {
            background: #f8f9fa;
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .actionable-card {
            background: #fff5f5;
            border: 2px solid #e74c3c;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(231, 76, 60, 0.1);
        }

        .actionable-header {
            background: #e74c3c;
            color: white;
            padding: 10px 15px;
            margin: -25px -25px 20px -25px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 1.1em;
        }

        .action-item {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .action-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .copy-code {
            background: #1e1e1e;
            color: #ddd;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            margin: 10px 0;
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .copy-button:hover {
            background: #218838;
        }

        .insight-card h4 {
            color: #138496;
            margin-bottom: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="language-toggle">
        <button onclick="switchLanguage('en')" class="lang-btn active" id="lang-en">English</button>
        <button onclick="switchLanguage('bg')" class="lang-btn" id="lang-bg">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</button>
    </div>

    <div class="header">
        <h1 data-en="QCI Analysis Dashboard" data-bg="–¢–∞–±–ª–æ –∑–∞ QCI –ê–Ω–∞–ª–∏–∑">QCI Analysis Dashboard</h1>
        <div class="subtitle" data-en="Quality Call Index Performance Analytics" data-bg="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–∞ –∏–Ω–¥–µ–∫—Å–∞ –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∏—Ç–µ">Quality Call Index Performance Analytics</div>
    </div>

    <div class="container">
        <div id="loading" class="loading">
            <span data-en="Loading analysis data..." data-bg="–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –∞–Ω–∞–ª–∏–∑...">Loading analysis data...</span>
        </div>

        <!-- Overall Statistics -->
        <div id="stats-section" class="stats-grid hidden">
            <div class="stat-card">
                <div class="number" id="total-calls">0</div>
                <div class="label" data-en="Total Calls Analyzed" data-bg="–û–±—â–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∏">Total Calls Analyzed</div>
            </div>
            <div class="stat-card">
                <div class="number" id="avg-qci">0</div>
                <div class="label" data-en="Average QCI Score" data-bg="–°—Ä–µ–¥–µ–Ω QCI —Ä–µ–∑—É–ª—Ç–∞—Ç">Average QCI Score</div>
            </div>
            <div class="stat-card">
                <div class="number" id="pass-rate">0%</div>
                <div class="label" data-en="Pass Rate (QCI ‚â•80)" data-bg="–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö (QCI ‚â•80)">Pass Rate (QCI ‚â•80)</div>
            </div>
            <div class="stat-card">
                <div class="number" id="total-cost">$0</div>
                <div class="label" data-en="Analysis Cost" data-bg="–†–∞–∑—Ö–æ–¥–∏ –∑–∞ –∞–Ω–∞–ª–∏–∑">Analysis Cost</div>
            </div>
            <div class="stat-card">
                <div class="number" id="brand-accuracy">0%</div>
                <div class="label" data-en="Young Caesar Mentions" data-bg="–°–ø–æ–º–µ–Ω–∞–≤–∞–Ω–∏—è –Ω–∞ Young Caesar">Young Caesar Mentions</div>
            </div>
            <div class="stat-card">
                <div class="number" id="total-assistants">0</div>
                <div class="label" data-en="Active Assistants" data-bg="–ê–∫—Ç–∏–≤–Ω–∏ –∞—Å–∏—Å—Ç–µ–Ω—Ç–∏">Active Assistants</div>
            </div>
        </div>

        <!-- QCI Distribution Chart -->
        <div id="qci-distribution" class="chart-section hidden">
            <h2 data-en="QCI Score Distribution" data-bg="–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ QCI —Ä–µ–∑—É–ª—Ç–∞—Ç–∏">QCI Score Distribution</h2>
            <div class="chart-container">
                <canvas id="qciChart"></canvas>
            </div>
        </div>

        <!-- Performance by Category -->
        <div id="category-performance" class="chart-section hidden">
            <h2 data-en="Performance by Category" data-bg="–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è">Performance by Category</h2>
            <div class="chart-container">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>

        <!-- Assistant Performance Section -->
        <div id="assistant-section" class="assistant-section hidden">
            <h2 data-en="Assistant Performance Analysis" data-bg="–ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –∞—Å–∏—Å—Ç–µ–Ω—Ç–∏—Ç–µ">Assistant Performance Analysis</h2>
            <div id="assistant-cards"></div>
        </div>

        <!-- Key Insights -->
        <div id="insights-section" class="insights-section hidden">
            <h2 data-en="Key Insights & Recommendations" data-bg="–ö–ª—é—á–æ–≤–∏ –ø—Ä–æ–∑—Ä–µ–Ω–∏—è –∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏">Key Insights & Recommendations</h2>
            <div id="insights-cards"></div>
        </div>

        <!-- Actionable Recommendations -->
        <div id="actionable-section" class="insights-section hidden">
            <h2 data-en="üéØ Actionable Recommendations (Copy & Paste Ready)" data-bg="üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ (–≥–æ—Ç–æ–≤–∏ –∑–∞ –∫–æ–ø–∏—Ä–∞–Ω–µ)">üéØ Actionable Recommendations (Copy & Paste Ready)</h2>
            <div id="actionable-cards"></div>
        </div>

        <!-- Detailed Data Table -->
        <div id="detailed-data" class="chart-section hidden">
            <h2 data-en="Detailed Call Analysis" data-bg="–î–µ—Ç–∞–π–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∏—Ç–µ">Detailed Call Analysis</h2>
            <table class="data-table" id="calls-table">
                <thead>
                    <tr>
                        <th data-en="Call ID" data-bg="ID –Ω–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä">Call ID</th>
                        <th data-en="Assistant" data-bg="–ê—Å–∏—Å—Ç–µ–Ω—Ç">Assistant</th>
                        <th data-en="QCI Score" data-bg="QCI –†–µ–∑—É–ª—Ç–∞—Ç">QCI Score</th>
                        <th data-en="Dynamics" data-bg="–î–∏–Ω–∞–º–∏–∫–∞">Dynamics</th>
                        <th data-en="Objections" data-bg="–í—ä–∑—Ä–∞–∂–µ–Ω–∏—è">Objections</th>
                        <th data-en="Brand" data-bg="–ë—Ä–∞–Ω–¥">Brand</th>
                        <th data-en="Outcome" data-bg="–†–µ–∑—É–ª—Ç–∞—Ç">Outcome</th>
                        <th data-en="Status" data-bg="–°—Ç–∞—Ç—É—Å">Status</th>
                    </tr>
                </thead>
                <tbody id="calls-table-body">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentLanguage = 'en';
        let analysisData = null;

        // Language switching
        function switchLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang-${lang}`).classList.add('active');

            document.querySelectorAll('[data-en]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
        }

        function generateActionableRecommendations() {
            const actionableContainer = document.getElementById('actionable-cards');

            // Get assistant stats for analysis
            const assistantStats = extractAssistantStats();
            const sortedAssistants = Object.entries(assistantStats)
                .map(([id, stats]) => ({id, ...stats}))
                .sort((a, b) => b.avgQCI - a.avgQCI);

            actionableContainer.innerHTML = '';

            // Priority 1: Fix zero-brand assistants (most critical)
            const zeroBrandAssistants = sortedAssistants.filter(a => a.avgBrand < 5 && a.callCount > 10);
            if (zeroBrandAssistants.length > 0) {
                const criticalCard = createActionableCard(
                    'üö® CRITICAL: Fix Brand Mentions (Zero Brand Score)',
                    'These assistants are not mentioning "Young Caesar" brand at all',
                    zeroBrandAssistants.map(assistant => ({
                        title: `Assistant ${assistant.id.substring(0, 8)} (${assistant.callCount} calls, Brand: ${assistant.avgBrand}/20)`,
                        action: 'Add brand mention to system prompt',
                        code: `// Update system prompt for assistant ${assistant.id}
// Add this to the beginning of your prompt:

"You are [NAME], a professional representative from Young Caesar.
ALWAYS introduce yourself as '[NAME] from Young Caesar' in the first message.
Example: 'Hi, this is Alex from Young Caesar. Quick question...'"

// Current issue: ${assistant.callCount} calls with average Brand score of only ${assistant.avgBrand}/20
// Expected result: Brand score should increase to 15-20/20`,
                        priority: 'URGENT'
                    }))
                );
                actionableContainer.appendChild(criticalCard);
            }

            // Priority 2: Scale best practices from top performer
            const topPerformer = sortedAssistants[0];
            if (topPerformer && topPerformer.avgQCI > 40) {
                const bestPracticeCard = createActionableCard(
                    'üèÜ Scale Best Practices from Top Performer',
                    `Assistant ${topPerformer.id.substring(0, 8)} has the highest QCI (${topPerformer.avgQCI}/100)`,
                    [{
                        title: `Copy successful patterns from ${topPerformer.id.substring(0, 8)}`,
                        action: 'Apply this proven prompt structure to other assistants',
                        code: `// Best performing assistant: ${topPerformer.id}
// Performance: ${topPerformer.avgQCI}/100 QCI, ${topPerformer.callCount} calls
// Strong areas: Dynamics ${topPerformer.avgDynamics}/30, Brand ${topPerformer.avgBrand}/20

// Names used successfully: ${Array.from(topPerformer.names).join(', ')}

// ACTION: Copy the system prompt from assistant ${topPerformer.id.substring(0, 8)}
// and adapt it for your underperforming assistants.
// Focus on maintaining the same introduction style and brand mention patterns.`,
                        priority: 'HIGH'
                    }]
                );
                actionableContainer.appendChild(bestPracticeCard);
            }

            // Priority 3: Fix high-volume, low-quality assistants
            const highVolumeWeak = sortedAssistants.filter(a => a.callCount > 100 && a.avgQCI < 25);
            if (highVolumeWeak.length > 0) {
                const volumeCard = createActionableCard(
                    'üìä Fix High-Volume, Low-Quality Assistants',
                    'These assistants make many calls but with poor quality',
                    highVolumeWeak.map(assistant => ({
                        title: `Assistant ${assistant.id.substring(0, 8)} (${assistant.callCount} calls, QCI: ${assistant.avgQCI}/100)`,
                        action: 'Comprehensive prompt overhaul needed',
                        code: `// High-volume assistant ${assistant.id} needs immediate attention
// Current: ${assistant.callCount} calls, QCI only ${assistant.avgQCI}/100
// Problem areas:
//   - Dynamics: ${assistant.avgDynamics}/30 (should be 20+)
//   - Brand: ${assistant.avgBrand}/20 (should be 15+)
//   - Outcome: ${assistant.avgOutcome}/30 (should be 15+)

// SOLUTION: Replace entire system prompt with proven template from ${topPerformer.id.substring(0, 8)}
// Then add specific improvements:

1. Brand mention: "Hi, this is [NAME] from Young Caesar"
2. Clear value proposition
3. Specific ask for contact information
4. Professional objection handling

// Expected improvement: QCI should increase to 40+ within 50 calls`,
                        priority: 'HIGH'
                    }))
                );
                actionableContainer.appendChild(volumeCard);
            }

            // Priority 4: Optimize prompt variations
            const multipleNames = sortedAssistants.filter(a => Array.from(a.names).length > 1);
            if (multipleNames.length > 0) {
                const variationCard = createActionableCard(
                    'üîÑ Optimize Prompt Variations',
                    'These assistants used multiple names - analyze which performed better',
                    multipleNames.map(assistant => ({
                        title: `Assistant ${assistant.id.substring(0, 8)} used ${Array.from(assistant.names).length} different names`,
                        action: 'Analyze performance by name variation',
                        code: `// Assistant ${assistant.id} used multiple names: ${Array.from(assistant.names).join(', ')}
// Current average QCI: ${assistant.avgQCI}/100

// ACTION NEEDED:
// 1. Export call data for this assistant
// 2. Segment performance by each name used
// 3. Identify which name variant performed best
// 4. Standardize on the best-performing variant
// 5. Update prompt to use only the winning name

// SQL-like analysis needed:
// SELECT name_used, AVG(qci_total), COUNT(*)
// FROM calls
// WHERE assistant_id = '${assistant.id}'
// GROUP BY name_used
// ORDER BY AVG(qci_total) DESC`,
                        priority: 'MEDIUM'
                    }))
                );
                actionableContainer.appendChild(variationCard);
            }

            // Priority 5: Summary action plan
            const summaryCard = createActionableCard(
                'üìã Implementation Checklist',
                'Complete this checklist to improve overall QCI from current average to target 50+',
                [{
                    title: 'Week 1: Critical Fixes',
                    action: 'Fix all zero-brand assistants immediately',
                    code: `‚úÖ Update prompts for assistants: ${zeroBrandAssistants.map(a => a.id.substring(0, 8)).join(', ')}
‚úÖ Add mandatory "from Young Caesar" introduction
‚úÖ Test with 10 calls per assistant
‚úÖ Verify brand score increases to 15+/20`,
                    priority: 'WEEK 1'
                }, {
                    title: 'Week 2: Scale Success',
                    action: 'Apply top performer patterns to all assistants',
                    code: `‚úÖ Copy prompt structure from assistant ${topPerformer.id.substring(0, 8)}
‚úÖ Update ${highVolumeWeak.length} high-volume assistants first
‚úÖ Monitor QCI improvement after 50 calls each
‚úÖ Target: Average QCI 35+ across all assistants`,
                    priority: 'WEEK 2'
                }, {
                    title: 'Week 3: Optimization',
                    action: 'Fine-tune and standardize all prompts',
                    code: `‚úÖ Analyze name variation performance
‚úÖ Standardize on best-performing variants
‚úÖ Remove underperforming prompt elements
‚úÖ Target: Average QCI 45+ across all assistants`,
                    priority: 'WEEK 3'
                }]
            );
            actionableContainer.appendChild(summaryCard);
        }

        function createActionableCard(title, description, actions) {
            const card = document.createElement('div');
            card.className = 'actionable-card';

            let actionsHTML = actions.map(action => `
                <div class="action-item">
                    <div class="action-title">${action.title}</div>
                    <div>${action.action}</div>
                    <div class="copy-code">
                        <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>${action.code}
                    </div>
                    <small><strong>Priority: ${action.priority}</strong></small>
                </div>
            `).join('');

            card.innerHTML = `
                <div class="actionable-header">${title}</div>
                <p><strong>${description}</strong></p>
                ${actionsHTML}
            `;

            return card;
        }

        function copyToClipboard(button) {
            const codeBlock = button.parentElement;
            const text = codeBlock.textContent.replace('Copy', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                button.style.background = '#28a745';
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.style.background = '#28a745';
                }, 2000);
            });
        }

        // Load analysis data
        async function loadAnalysisData() {
            try {
                // This will be updated with the actual file path once analysis is complete
                
                // Static data embedded for GitHub Pages compatibility
                analysisData = {
  "config": {
    "INPUT": {
      "DATA_FILE": "results/calls_for_analysis.json",
      "MIN_TRANSCRIPT_LENGTH": 100
    },
    "TESTING": {
      "ENABLED": true,
      "BATCH_SIZE": 5,
      "SPECIFIC_CALL_ID": ""
    },
    "OPENAI": {
      "MODEL": "gpt-4o-mini",
      "TEMPERATURE": 0.1,
      "MAX_TOKENS": 2000
    },
    "PROCESSING": {
      "CONCURRENCY": 15,
      "BATCH_DELAY": 1000,
      "RETRY_ATTEMPTS": 2,
      "RETRY_DELAY": 3000
    },
    "OUTPUT": {
      "RESULTS_DIR": "results",
      "VERBOSE": true
    }
  },
  "stats": {
    "processed": 5,
    "failed": 0,
    "totalCost": 0.004630649999999999,
    "startTime": 1761200050033,
    "errors": [],
    "totalTime": 6.988,
    "avgTimePerCall": 1.3976000000000002,
    "avgCostPerCall": 0.0009261299999999998,
    "avgQCI": 61,
    "successRate": "100.0"
  },
  "results": [
    {
      "call_id": "0199bc7c-889b-7bb5-a2ac-3dc70fd2f9b7",
      "assistant_id": "1a9692a3-bc41-4d9f-b1db-a45170e9fbfe",
      "transcript_length": 4540,
      "qci_total": 55,
      "dynamics": 18,
      "objections": 5,
      "brand": 15,
      "outcome": 17,
      "status": "fail",
      "ai_analysis": {
        "qci_total_score": 55,
        "dynamics_total": 18,
        "objections_total": 5,
        "brand_total": 15,
        "outcome_total": 17,
        "evidence": {
          "agent_talk_ratio": "45%",
          "brand_mentions": [
            "Hi. This is Lea Dell from Young Caesar."
          ],
          "outcomes": [
            "I'll reach out to Servi at the confirmed email and phone number 9 8 1 0 0 0 4 5 3 9."
          ],
          "key_moments": [
            "Could you spell the email clearly"
          ]
        },
        "coaching_tips": [
          "Improve flow by minimizing interruptions and confirming information more efficiently.",
          "Enhance engagement by asking more open-ended questions.",
          "Ensure clarity in communication to avoid confusion over details."
        ]
      },
      "cost": 0.0011866499999999998,
      "tokens": 7374,
      "timestamp": "2025-10-23T06:14:15.504Z"
    },
    {
      "call_id": "0199b9ae-4a68-7224-ab47-6dab6ecbddab",
      "assistant_id": "1a9692a3-bc41-4d9f-b1db-a45170e9fbfe",
      "transcript_length": 4324,
      "qci_total": 55,
      "dynamics": 18,
      "objections": 10,
      "brand": 15,
      "outcome": 12,
      "status": "fail",
      "ai_analysis": {
        "qci_total_score": 55,
        "dynamics_total": 18,
        "objections_total": 10,
        "brand_total": 15,
        "outcome_total": 12,
        "evidence": {
          "agent_talk_ratio": "45%",
          "brand_mentions": [
            "I'm calling from Young Caesar about helping you win more customers for your gluing solutions without trade shows or cold outreach."
          ],
          "outcomes": [
            "Information exchanged: 'If it looks useful, we can book a quick walkthrough later.'"
          ],
          "key_moments": [
            "User confirmed their email: 'Okay. I'm going to spell it. M a r t e t e n d at m e l e r dot e u.'"
          ]
        },
        "coaching_tips": [
          "Improve flow by minimizing repetition and clarifying questions.",
          "Enhance objection handling by acknowledging user concerns more effectively.",
          "Increase engagement by asking more open-ended questions."
        ]
      },
      "cost": 0.00103125,
      "tokens": 6272,
      "timestamp": "2025-10-23T06:14:15.585Z"
    },
    {
      "call_id": "0199bc7b-9b8d-7889-9b2c-b51fd18873ec",
      "assistant_id": "1a9692a3-bc41-4d9f-b1db-a45170e9fbfe",
      "transcript_length": 3218,
      "qci_total": 70,
      "dynamics": 20,
      "objections": 10,
      "brand": 15,
      "outcome": 25,
      "status": "review",
      "ai_analysis": {
        "qci_total_score": 70,
        "dynamics_total": 20,
        "objections_total": 10,
        "brand_total": 15,
        "outcome_total": 25,
        "evidence": {
          "agent_talk_ratio": "60%",
          "brand_mentions": [
            "Hi. This is Paisley Edwards from Young Caesar.",
            "Thanks. This is Paisley Edwards from Young Caesar."
          ],
          "outcomes": [
            "I'll send a clear 1 page checklist to help capture the customer's detailed requirements for AMR robot systems plus next steps."
          ],
          "key_moments": [
            "I'll email a 1 page checklist to confirm the customer's detailed requirements and gaps before we proceed."
          ]
        },
        "coaching_tips": [
          "Improve engagement by asking more open-ended questions.",
          "Reduce repetition in responses to enhance flow.",
          "Clarify next steps more assertively to drive commitment."
        ]
      },
      "cost": 0.0008170499999999999,
      "tokens": 4874,
      "timestamp": "2025-10-23T06:14:16.395Z"
    },
    {
      "call_id": "0199b986-773b-7dd7-9056-7be6ff585d8d",
      "assistant_id": "1a9692a3-bc41-4d9f-b1db-a45170e9fbfe",
      "transcript_length": 3005,
      "qci_total": 55,
      "dynamics": 20,
      "objections": 0,
      "brand": 15,
      "outcome": 20,
      "status": "fail",
      "ai_analysis": {
        "qci_total_score": 55,
        "dynamics_total": 20,
        "objections_total": 0,
        "brand_total": 15,
        "outcome_total": 20,
        "evidence": {
          "agent_talk_ratio": "45%",
          "brand_mentions": [
            "Hi. This is Samantha Evans from Young Caesar.",
            "Hey, David. This is Samantha Evans from Young Caesar.",
            "Hey, David. Samantha Evans from Young Caesar."
          ],
          "outcomes": [
            "Callback arranged: 'You can call me back or I can send an invite.'"
          ],
          "key_moments": [
            "It's regarding a quick follow-up on an email about bringing in more clients for your industrial walk in oven."
          ]
        },
        "coaching_tips": [
          "Improve objection handling by recognizing and addressing potential concerns from the user.",
          "Enhance engagement by asking more open-ended questions to encourage dialogue.",
          "Ensure clarity in communication to avoid confusion in message recording."
        ]
      },
      "cost": 0.0008050499999999999,
      "tokens": 4752,
      "timestamp": "2025-10-23T06:14:14.176Z"
    },
    {
      "call_id": "0199b961-d9f7-7aa9-8ca9-4bde86f9a620",
      "assistant_id": "1a9692a3-bc41-4d9f-b1db-a45170e9fbfe",
      "transcript_length": 2968,
      "qci_total": 70,
      "dynamics": 22,
      "objections": 15,
      "brand": 15,
      "outcome": 18,
      "status": "review",
      "ai_analysis": {
        "qci_total_score": 70,
        "dynamics_total": 22,
        "objections_total": 15,
        "brand_total": 15,
        "outcome_total": 18,
        "evidence": {
          "agent_talk_ratio": "55%",
          "brand_mentions": [
            "Hi. This is Audrey Long from Young Caesar."
          ],
          "outcomes": [
            "I'll send a short summary with how we source and qualify horizontal machining centers leads."
          ],
          "key_moments": [
            "You're right to feel that way. Really sorry we dropped the ball."
          ]
        },
        "coaching_tips": [
          "Improve flow by minimizing interruptions.",
          "Clarify the value proposition earlier in the call.",
          "Ensure to confirm the email address accurately without confusion."
        ]
      },
      "cost": 0.00079065,
      "tokens": 4782,
      "timestamp": "2025-10-23T06:14:14.941Z"
    }
  ],
  "summary": {
    "total_calls": 5,
    "avg_qci": "61.0",
    "pass_rate": "0.0",
    "total_cost": "0.0046",
    "total_time": "0m 6s"
  }
};
                processData();
        }

        function loadSampleData() {
            // Sample data structure for development
            analysisData = {
                stats: {
                    processed: 884,
                    avgQCI: 52.3,
                    totalCost: 0.265,
                    successRate: "100.0"
                },
                results: [], // Will be populated with actual data
                summary: {
                    total_calls: 884,
                    avg_qci: "52.3",
                    pass_rate: "15.2",
                    total_cost: "0.2650"
                }
            };
            processData();
        }

        function processData() {
            if (!analysisData) return;

            // Hide loading and show content
            document.getElementById('loading').classList.add('hidden');
            document.querySelectorAll('.hidden').forEach(el => {
                if (el.id !== 'loading') el.classList.remove('hidden');
            });

            // Update overall statistics
            updateOverallStats();

            // Create charts
            createQCIDistributionChart();
            createCategoryChart();

            // Analyze assistants
            analyzeAssistants();

            // Generate insights
            generateInsights();

            // Generate actionable recommendations
            generateActionableRecommendations();

            // Populate detailed table
            populateDetailedTable();
        }

        function updateOverallStats() {
            document.getElementById('total-calls').textContent = analysisData.stats.processed || 0;
            document.getElementById('avg-qci').textContent = parseFloat(analysisData.stats.avgQCI || 0).toFixed(1);
            document.getElementById('pass-rate').textContent = (analysisData.summary.pass_rate || '0') + '%';
            document.getElementById('total-cost').textContent = '$' + parseFloat(analysisData.stats.totalCost || 0).toFixed(3);

            // Calculate brand accuracy (Young Caesar mentions)
            const brandAccuracy = calculateBrandAccuracy();
            document.getElementById('brand-accuracy').textContent = brandAccuracy + '%';

            // Count unique assistants
            const assistantCount = countUniqueAssistants();
            document.getElementById('total-assistants').textContent = assistantCount;
        }

        function calculateBrandAccuracy() {
            if (!analysisData.results || analysisData.results.length === 0) return 0;

            const withYoungCaesar = analysisData.results.filter(call => {
                const mentions = call.ai_analysis?.evidence?.brand_mentions || [];
                return mentions.some(mention => mention.toLowerCase().includes('young caesar'));
            }).length;

            return Math.round((withYoungCaesar / analysisData.results.length) * 100);
        }

        function countUniqueAssistants() {
            if (!analysisData.results || analysisData.results.length === 0) return 0;

            const assistants = new Set();
            analysisData.results.forEach(call => {
                const evidence = call.ai_analysis?.evidence || {};
                // Extract assistant name from brand mentions or other evidence
                const mentions = evidence.brand_mentions || [];
                mentions.forEach(mention => {
                    const match = mention.match(/this is (\w+)/i);
                    if (match) assistants.add(match[1]);
                });
            });

            return assistants.size || 1; // Default to 1 if no clear assistant names found
        }

        function createQCIDistributionChart() {
            const ctx = document.getElementById('qciChart').getContext('2d');

            // Create QCI distribution bins
            const bins = [0, 20, 40, 60, 80, 100];
            const binLabels = ['0-19', '20-39', '40-59', '60-79', '80-100'];
            const binCounts = new Array(bins.length - 1).fill(0);

            if (analysisData.results) {
                analysisData.results.forEach(call => {
                    const qci = call.qci_total || 0;
                    for (let i = 0; i < bins.length - 1; i++) {
                        if (qci >= bins[i] && qci < bins[i + 1]) {
                            binCounts[i]++;
                            break;
                        }
                    }
                });
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Number of Calls',
                        data: binCounts,
                        backgroundColor: [
                            '#e74c3c', '#f39c12', '#f1c40f', '#2ecc71', '#27ae60'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Calls'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'QCI Score Range'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribution of QCI Scores'
                        }
                    }
                }
            });
        }

        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');

            // Calculate average scores by category
            let avgDynamics = 0, avgObjections = 0, avgBrand = 0, avgOutcome = 0;

            if (analysisData.results && analysisData.results.length > 0) {
                const totals = analysisData.results.reduce((acc, call) => {
                    acc.dynamics += call.dynamics || 0;
                    acc.objections += call.objections || 0;
                    acc.brand += call.brand || 0;
                    acc.outcome += call.outcome || 0;
                    return acc;
                }, { dynamics: 0, objections: 0, brand: 0, outcome: 0 });

                const count = analysisData.results.length;
                avgDynamics = (totals.dynamics / count).toFixed(1);
                avgObjections = (totals.objections / count).toFixed(1);
                avgBrand = (totals.brand / count).toFixed(1);
                avgOutcome = (totals.outcome / count).toFixed(1);
            }

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Dynamics (30)', 'Objections (20)', 'Brand (20)', 'Outcome (30)'],
                    datasets: [{
                        label: 'Average Score',
                        data: [avgDynamics, avgObjections, avgBrand, avgOutcome],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(52, 152, 219, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            borderWidth: 3
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: false
                            },
                            suggestedMin: 0,
                            suggestedMax: 30
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Average Performance by Category'
                        }
                    }
                }
            });
        }

        function analyzeAssistants() {
            // This function will analyze performance by assistant
            const assistantContainer = document.getElementById('assistant-cards');

            // Extract assistant data from results
            const assistantStats = extractAssistantStats();

            assistantContainer.innerHTML = '';

            Object.entries(assistantStats).forEach(([assistantId, stats]) => {
                const assistantCard = createAssistantCard(assistantId, stats);
                assistantContainer.appendChild(assistantCard);
            });
        }

        function extractAssistantStats() {
            if (!analysisData.results || analysisData.results.length === 0) {
                return {
                    'Unknown Assistant': {
                        callCount: 0,
                        avgQCI: 0,
                        avgDynamics: 0,
                        avgObjections: 0,
                        avgBrand: 0,
                        avgOutcome: 0,
                        passRate: 0,
                        recommendations: ['Insufficient data for analysis']
                    }
                };
            }

            const assistants = {};

            analysisData.results.forEach(call => {
                let assistantId = call.assistant_id || 'unknown';

                // Extract assistant name from brand mentions to track prompt changes
                let detectedName = 'Unknown';
                const mentions = call.ai_analysis?.evidence?.brand_mentions || [];
                for (const mention of mentions) {
                    const match = mention.match(/this is (\w+[\s\w]*?)(?:\s+from|\.|$)/i);
                    if (match) {
                        detectedName = match[1].trim();
                        break;
                    }
                }

                if (!assistants[assistantId]) {
                    assistants[assistantId] = {
                        calls: [],
                        callCount: 0,
                        totalQCI: 0,
                        totalDynamics: 0,
                        totalObjections: 0,
                        totalBrand: 0,
                        totalOutcome: 0,
                        passCount: 0,
                        names: new Set(), // Track all names used by this assistant
                        assistantId: assistantId
                    };
                }

                const assistant = assistants[assistantId];
                assistant.calls.push(call);
                assistant.callCount++;
                assistant.totalQCI += call.qci_total || 0;
                assistant.totalDynamics += call.dynamics || 0;
                assistant.totalObjections += call.objections || 0;
                assistant.totalBrand += call.brand || 0;
                assistant.totalOutcome += call.outcome || 0;
                assistant.names.add(detectedName); // Track all names used

                if ((call.qci_total || 0) >= 80) {
                    assistant.passCount++;
                }
            });

            // Calculate averages and generate recommendations
            Object.keys(assistants).forEach(assistantId => {
                const assistant = assistants[assistantId];
                const count = assistant.callCount;

                assistant.avgQCI = (assistant.totalQCI / count).toFixed(1);
                assistant.avgDynamics = (assistant.totalDynamics / count).toFixed(1);
                assistant.avgObjections = (assistant.totalObjections / count).toFixed(1);
                assistant.avgBrand = (assistant.totalBrand / count).toFixed(1);
                assistant.avgOutcome = (assistant.totalOutcome / count).toFixed(1);
                assistant.passRate = ((assistant.passCount / count) * 100).toFixed(1);

                assistant.recommendations = generateAssistantRecommendations(assistant);
            });

            return assistants;
        }

        function generateAssistantRecommendations(assistant) {
            const recommendations = [];

            if (parseFloat(assistant.avgDynamics) < 15) {
                recommendations.push("Improve conversation flow and engagement");
                recommendations.push("Work on reducing dead air and repetition");
            }

            if (parseFloat(assistant.avgObjections) < 10) {
                recommendations.push("Better recognition and handling of objections");
                recommendations.push("Practice offering alternatives when facing resistance");
            }

            if (parseFloat(assistant.avgBrand) < 15) {
                recommendations.push("Ensure consistent Young Caesar brand mentions");
                recommendations.push("Focus on clear professional identification");
            }

            if (parseFloat(assistant.avgOutcome) < 15) {
                recommendations.push("Work on securing concrete meeting outcomes");
                recommendations.push("Improve call-to-action effectiveness");
            }

            if (parseFloat(assistant.passRate) < 20) {
                recommendations.push("Focus on overall call quality improvement");
                recommendations.push("Review and practice core sales conversation skills");
            }

            if (recommendations.length === 0) {
                recommendations.push("Maintain current high performance standards");
                recommendations.push("Share best practices with other team members");
            }

            return recommendations;
        }

        function createAssistantCard(assistantId, stats) {
            const card = document.createElement('div');
            card.className = 'assistant-card';

            const qualityBadge = getQualityBadge(parseFloat(stats.avgQCI));
            const namesUsed = Array.from(stats.names).filter(n => n !== 'Unknown').join(', ') || 'No names detected';

            card.innerHTML = `
                <div class="assistant-header">
                    <div class="assistant-name">
                        <strong>Assistant ${assistantId.substring(0, 8)}</strong> (${stats.callCount} calls)${qualityBadge}
                        <div class="assistant-names">Names used: ${namesUsed}</div>
                    </div>
                    <div class="assistant-score">${stats.avgQCI}/100</div>
                </div>

                <div class="score-breakdown">
                    <div class="score-item">
                        <div class="score-value">${stats.avgDynamics}/30</div>
                        <div class="score-label">Dynamics</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${stats.avgObjections}/20</div>
                        <div class="score-label">Objections</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${stats.avgBrand}/20</div>
                        <div class="score-label">Brand</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value">${stats.avgOutcome}/30</div>
                        <div class="score-label">Outcome</div>
                    </div>
                </div>

                <div class="recommendations">
                    <h4>Prompt Improvement Recommendations:</h4>
                    <ul>
                        ${stats.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;

            return card;
        }

        function getQualityBadge(qci) {
            if (qci >= 80) {
                return '<span class="quality-badge quality-pass">PASS</span>';
            } else if (qci >= 60) {
                return '<span class="quality-badge quality-review">REVIEW</span>';
            } else {
                return '<span class="quality-badge quality-fail">FAIL</span>';
            }
        }

        function generateInsights() {
            const insightsContainer = document.getElementById('insights-cards');

            const insights = [
                {
                    title: "Overall Performance",
                    content: `Average QCI score of ${analysisData.stats.avgQCI || 0} indicates ${getPerformanceLevel(analysisData.stats.avgQCI)} performance across the organization.`
                },
                {
                    title: "Brand Consistency",
                    content: `${calculateBrandAccuracy()}% of calls properly mention Young Caesar brand, indicating ${getBrandConsistencyLevel(calculateBrandAccuracy())} brand adherence.`
                },
                {
                    title: "Cost Efficiency",
                    content: `Analysis cost of $${parseFloat(analysisData.stats.totalCost || 0).toFixed(3)} for ${analysisData.stats.processed || 0} calls demonstrates excellent ROI for quality monitoring.`
                },
                {
                    title: "Improvement Opportunities",
                    content: "Focus on dynamics and outcome categories for maximum QCI improvement potential based on current performance patterns."
                }
            ];

            insightsContainer.innerHTML = insights.map(insight => `
                <div class="insight-card">
                    <h4>${insight.title}</h4>
                    <p>${insight.content}</p>
                </div>
            `).join('');
        }

        function getPerformanceLevel(qci) {
            const score = parseFloat(qci) || 0;
            if (score >= 80) return "excellent";
            if (score >= 60) return "good";
            if (score >= 40) return "moderate";
            return "needs improvement";
        }

        function getBrandConsistencyLevel(percentage) {
            if (percentage >= 90) return "excellent";
            if (percentage >= 75) return "good";
            if (percentage >= 50) return "moderate";
            return "poor";
        }

        function populateDetailedTable() {
            const tableBody = document.getElementById('calls-table-body');

            if (!analysisData.results || analysisData.results.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8">No data available</td></tr>';
                return;
            }

            // Show first 50 calls for performance
            const callsToShow = analysisData.results.slice(0, 50);

            tableBody.innerHTML = callsToShow.map(call => {
                const assistantName = extractAssistantName(call);
                const statusBadge = getQualityBadge(call.qci_total || 0);

                return `
                    <tr>
                        <td>${(call.call_id || '').substring(0, 8)}...</td>
                        <td>${assistantName}</td>
                        <td>${call.qci_total || 0}</td>
                        <td>${call.dynamics || 0}</td>
                        <td>${call.objections || 0}</td>
                        <td>${call.brand || 0}</td>
                        <td>${call.outcome || 0}</td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            }).join('');
        }

        function extractAssistantName(call) {
            const mentions = call.ai_analysis?.evidence?.brand_mentions || [];
            for (const mention of mentions) {
                const match = mention.match(/this is (\w+[\s\w]*)/i);
                if (match) {
                    return match[1].trim();
                }
            }
            return 'Unknown';
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadAnalysisData();
        });

        // Refresh data every 30 seconds while analysis is running
        setInterval(() => {
            if (document.getElementById('loading').classList.contains('hidden')) {
                // Data already loaded, stop checking
                return;
            }
            loadAnalysisData();
        }, 30000);
    </script>
</body>
</html>
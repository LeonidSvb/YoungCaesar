# –°–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è VAPI sync –≤ logger

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ (20 –æ–∫—Ç—è–±—Ä—è 2025)

‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ MCP:**
- `20251020_transform_sync_logs_to_runs.sql` - –¢–∞–±–ª–∏—Ü–∞ runs —Å–æ–∑–¥–∞–Ω–∞
- `20251020_create_logs_table.sql` - –¢–∞–±–ª–∏—Ü–∞ logs —Å–æ–∑–¥–∞–Ω–∞
- `20251020_013_fix_rpc_correct_types.sql` - RPC —Ñ—É–Ω–∫—Ü–∏–∏ dashboard –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `lib/logger.js` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- `scripts/sync-vapi-calls.js` –ø–∏—à–µ—Ç –ª–æ–≥–∏ –≤ Supabase
- 6 –ª–æ–≥–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ run

‚úÖ **Dashboard RPC —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- –í—Å–µ 3 —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (TEXT)
- 713 –∑–≤–æ–Ω–∫–æ–≤ –∑–∞ 30 –¥–Ω–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ API
- QCI JOIN —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ call_id

‚úÖ **GitHub Actions workflow —Å–æ–∑–¥–∞–Ω:**
- `.github/workflows/sync-vapi-calls.yml`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ UI

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ—Å—Å–∏—é

### 1. ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π VAPI sync –≤ logger —Å–∫—Ä–∏–ø—Ç

**–°–æ–∑–¥–∞–Ω:** `production_scripts/vapi_collection/src/sync_to_supabase_v2.js`
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** 926 –∑–≤–æ–Ω–∫–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, 24 –ª–æ–≥–∞ –∑–∞–ø–∏—Å–∞–Ω–æ, 52 —Å–µ–∫—É–Ω–¥—ã
**GitHub Actions:** –û–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è production —Å–∏—Å—Ç–µ–º–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 2. QCI Analysis –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ —Å QCI

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å `production_scripts/qci_analysis/analyze_new_calls.js`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `lib/logger.js` –¥–ª—è tracking
3. –î–æ–±–∞–≤–∏—Ç—å workflow: `.github/workflows/qci-analysis.yml`
4. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ sync (or –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤)

### 3. Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å runs/logs

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å execution history –≤ dashboard

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å `/admin/execution-logs` —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ runs —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (script_name, status, date)
3. Drill-down –≤ –¥–µ—Ç–∞–ª—å–Ω—ã–µ logs –¥–ª—è –∫–∞–∂–¥–æ–≥–æ run
4. –ì—Ä–∞—Ñ–∏–∫–∏: Success rate, duration trends, error frequency

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏

```
Vapi/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ sync-vapi-calls.yml          ‚úÖ –°–æ–∑–¥–∞–Ω (TODO: –æ–±–Ω–æ–≤–∏—Ç—å –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ sync)
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ logger.js                        ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω array destructuring)
‚îÇ
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 20251020_transform_sync_logs_to_runs.sql    ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ 20251020_create_logs_table.sql              ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞
‚îÇ   ‚îî‚îÄ‚îÄ 20251020_013_fix_rpc_correct_types.sql      ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ sync-vapi-calls.js               ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (mock –¥–∞–Ω–Ω—ã–µ)
‚îÇ
‚îî‚îÄ‚îÄ production_scripts/
    ‚îú‚îÄ‚îÄ vapi_collection/
    ‚îÇ   ‚îî‚îÄ‚îÄ src/
    ‚îÇ       ‚îî‚îÄ‚îÄ collect_vapi_data.js     üìù –°—É—â–µ—Å—Ç–≤—É–µ—Ç (–Ω—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
    ‚îÇ
    ‚îî‚îÄ‚îÄ vapi_sync/                       ‚è≥ TODO: –°–æ–∑–¥–∞—Ç—å
        ‚îî‚îÄ‚îÄ sync_to_supabase.js          ‚è≥ TODO: –°–æ–∑–¥–∞—Ç—å
```

## –¢–∞–±–ª–∏—Ü—ã –≤ Supabase (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π)

**Cron Logging:**
- ‚úÖ `runs` (17 –ø–æ–ª–µ–π) - Universal execution tracking
- ‚úÖ `logs` (7 –ø–æ–ª–µ–π) - Detailed step-by-step logs

**VAPI Data:**
- ‚úÖ `vapi_calls_raw` (8,559 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ `vapi_assistants` (13 –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤)
- ‚úÖ `qci_analyses` (918 –∞–Ω–∞–ª–∏–∑–æ–≤)

**RPC Functions (Fixed):**
- ‚úÖ `get_dashboard_metrics(TEXT, TIMESTAMPTZ, TIMESTAMPTZ)`
- ‚úÖ `get_calls_list(TEXT, TIMESTAMPTZ, TIMESTAMPTZ, TEXT, INT, INT)`
- ‚úÖ `get_timeline_data(TEXT, TIMESTAMPTZ, TIMESTAMPTZ, TEXT)`

## –ì–æ—Ç–æ–≤–æ –∫ production

‚úÖ **Logger —Å–∏—Å—Ç–µ–º–∞** - –ì–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ª—é–±—ã—Ö cron —Å–∫—Ä–∏–ø—Ç–∞—Ö
‚úÖ **Dashboard API** - –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ **GitHub Actions** - Workflow –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–Ω—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ sync)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

1. **HIGH:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π VAPI sync —Å logger
2. **HIGH:** –ó–∞–ø—É—Å—Ç–∏—Ç—å GitHub Actions —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. **MEDIUM:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å QCI analysis –¥–ª—è –Ω–æ–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
4. **MEDIUM:** Frontend —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ execution logs
5. **LOW:** Slack/email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö sync
